{% extends "Projects/base.html" %}
{% load static %}

{% block title %}Employee Update{% endblock %}

{% block content %}

<!-- ðŸ”¹ EXISTING UPDATES (ADMIN + DOMAIN DATA) -->
<h4 class="mb-3">Employee Updates</h4>

{% for u in updates %}
  <div class="card mb-3 border-start border-primary shadow-sm">
    <div class="card-body">

      <!-- ðŸ”¹ UPDATE DETAILS -->
      <h5 class="mb-1">{{ u.Project }}</h5>

      {% if u.task %}
        <p class="mb-1"><strong>Task:</strong> {{ u.task }}</p>
      {% endif %}

      {% if u.description %}
        <p class="mb-1">{{ u.description }}</p>
      {% endif %}

      {% if u.Things_To_Notice %}
        <p class="text-warning mb-1">{{ u.Things_To_Notice }}</p>
      {% endif %}

      {% if u.Deadline %}
        <small class="text-muted">
          Deadline: {{ u.Deadline|date:"d M Y, H:i" }}
        </small>
      {% endif %}

      <!-- ðŸ”¹ COMMUNICATION SECTION -->
      <div class="mt-4 p-3 border rounded bg-light">

        <h6 class="mb-2">Communication</h6>

        <!-- Existing communications -->
        {% for c in u.interactions.all %}
          <div class="mb-2 p-2 border rounded">
            <strong>{{ c.get_interaction_type_display }}</strong>
            <small class="text-muted">
              by {{ c.created_by.username }}
              Â· {{ c.created_at|date:"d M Y H:i" }}
            </small>
            <p class="mb-0">{{ c.message }}</p>
          </div>
        {% empty %}
          <p class="text-muted">No communication yet.</p>
        {% endfor %}

        <!-- Add new communication -->
        <form
          method="post"
          action="{% url 'Interactions:add_communication' u.id %}"
          class="mt-3"
        >
          {% csrf_token %}

          <div class="mb-2">
            {{ communication_form.interaction_type }}
          </div>

          <div class="mb-2">
            {{ communication_form.message }}
          </div>

          <button class="btn btn-sm btn-outline-primary">
            Submit
          </button>
        </form>

      </div>

    </div>
  </div>
{% empty %}
  <p class="text-muted">No updates yet.</p>
{% endfor %}

<hr class="my-4">

<!-- ðŸ”¹ YOUR ORIGINAL FORM (UNCHANGED) -->
<div class="card shadow-sm">
  <div class="card-body">
    <h3 class="card-title mb-3">Employee Update</h3>

    <form method="post" novalidate>
      {% csrf_token %}
      {{ form.non_field_errors }}

      {% for field in form %}
        <div class="mb-3">
          <label class="form-label" for="{{ field.id_for_label }}">
            {{ field.label }}
            {% if field.field.required %}
              <span class="text-danger">*</span>
            {% endif %}
          </label>

          {{ field }}

          {% if field.help_text %}
            <div class="form-text">{{ field.help_text }}</div>
          {% endif %}

          {% for err in field.errors %}
            <div class="text-danger small">{{ err }}</div>
          {% endfor %}
        </div>
      {% endfor %}

      <div class="d-flex gap-2">
        <button class="btn btn-primary" type="submit">Save</button>
        <a class="btn btn-outline-secondary" href="#">Back to list</a>
      </div>
    </form>
  </div>
</div>

{% endblock %}





